import Foundation

let input = """
Tile 3593:
#..#.##...
.#..#.#...
.#####..#.
.......#.#
#...#.....
..#.....##
.#....#...
.#..#.....
..#......#
#.####.##.

Tile 3041:
####.#.###
#..#..#.#.
.......#.#
#.....#...
....#....#
.#.......#
#..#.....#
#...#.....
##........
##.##...##

Tile 3761:
...#..##.#
#....#..#.
........#.
#..##.....
#..#.....#
.#....#..#
#.#....#..
#....#....
.....#...#
#.#####..#

Tile 1307:
...#######
#......#..
........#.
#.#......#
#........#
..........
#....#....
#..#..#..#
...#.##...
.....##.#.

Tile 3709:
#.##.#####
##....#...
..##.#..#.
....#.....
#..#..#..#
.........#
.........#
##.##.#.#.
...###....
#####.#...

Tile 2381:
.....#.##.
#........#
....#..#..
...#.#..##
.......###
...#.....#
.##.......
....#.....
......#..#
#.#######.

Tile 3089:
.....#..##
#....###.#
........##
......##.#
#.#...#..#
....##...#
#...#.#...
##.......#
..#..#...#
#...####.#

Tile 3049:
##.#.##.##
.#...#..#.
.#..##..##
...##.....
....#...##
#......###
#...#..#..
#.......#.
........##
##.##..#.#

Tile 1171:
#..#.##...
.#.......#
##......#.
.##..#.#.#
#...#..#.#
.....#..#.
.#..#.#...
.#........
....##..#.
#.##...###

Tile 2903:
#....#####
..#....#..
..#...#.##
#...#....#
..##.#..##
.#.#..#..#
..........
#...#.##..
#.......##
###..###.#

Tile 3259:
#..######.
..##.#..#.
#..#....##
....#....#
#........#
.......#.#
##.#..#...
#..#...###
.....#...#
##...###.#

Tile 2083:
.#.#...#..
.#.......#
.........#
#......#..
#.....#...
....#...##
##....##..
.#.....#.#
.###......
...#..####

Tile 1019:
##...##..#
..#.#.....
#..#...#..
#......###
.........#
..##....##
####..#..#
#.#..#..#.
#..#....#.
.#.#.###..

Tile 2659:
..#....#.#
##.#...#..
.##...##.#
..#.#..#.#
#.##..#.#.
.......#..
#.##......
#..#.#..#.
..#....#.#
...#.###.#

Tile 1873:
##.#####.#
..#....#..
..........
.......#.#
..#....##.
.......#..
.#....#...
#.......##
#.#.......
#.#....#..

Tile 2851:
#.#..#..##
#.#...#.#.
##.....#..
#...#.....
.#....#...
....#..#..
...#....##
#.##..###.
.#..##.#.#
.#..#....#

Tile 3529:
####....##
.....##..#
...##.#.#.
#.#..###.#
#.#....##.
....#..###
#......#.#
##......##
#.#.....##
.#.####..#

Tile 2221:
.#...#.###
##.##..###
#.........
.........#
#........#
......#..#
......#...
..##..#..#
.....#.#.#
..#.######

Tile 3251:
####.#.##.
#..#....#.
#....#.#.#
.....##..#
..........
#...#..#..
....######
..#.#....#
...#....#.
##.#.#...#

Tile 2693:
..###.####
.#....#..#
..##......
##.##...##
.#....#...
#...#....#
##..#.#..#
.##......#
.##.###..#
###.#..#.#

Tile 1187:
.#..###.##
..#.#.#..#
#.#......#
...#..#..#
#.....##..
#......#.#
##.....#..
......#..#
..........
#..##.....

Tile 1237:
####....#.
.#........
.#..###..#
#.#.....#.
#........#
....#....#
..#...#..#
#...##....
.#.#.#...#
.##..#....

Tile 1163:
#.#..#.#..
...#.###.#
.#...#..#.
#...###...
...#......
...#..#...
#...#....#
#....#...#
#...##..#.
#.######..

Tile 2113:
.##.#..###
#.#..##..#
.......#..
#....#....
##........
#....#...#
......#...
#......#..
#...##...#
#.##..####

Tile 3989:
#..###.###
#.....#.##
#.........
##........
#.........
#..#......
.....#...#
......#...
.#..#.....
#..#######

Tile 3163:
##..#...#.
...#..#..#
##.#.....#
.#....#.#.
#...###.#.
#....#....
...#.....#
#..#.#...#
#..#......
..#..#####

Tile 2137:
####..##.#
...#......
........##
...#..#.##
#.#..#.#..
.#..##...#
.#.#.###..
#...#.....
...##....#
.#..#..#.#

Tile 1087:
.#.##.####
..###.#...
#...#.....
##.......#
#......#.#
..#.......
#.#...#...
#...#....#
#.#......#
.#..######

Tile 1613:
.##..#####
..#.####.#
#...#....#
.#...##.#.
#.#.....#.
#.#..#...#
#.#.......
.##.....##
.....#...#
#..#.##.##

Tile 3613:
#......###
.....#....
.........#
#.#......#
.###....##
.#..##.#.#
#...#....#
#......#..
.........#
....#.....

Tile 2293:
#......#.#
#.....##.#
.....#...#
#........#
.#....##.#
#.#..#.###
.#.....#..
.........#
#.#.......
#....##..#

Tile 3373:
#####...##
..#..#...#
.........#
...#......
##.#.....#
#.........
#.#....#.#
....#.....
..##.#..#.
..#.#.#..#

Tile 2539:
#.##.####.
#.##..#..#
#....#...#
#...##...#
.#....#..#
.#........
.......##.
#.....#...
.....#...#
.#.....#..

Tile 2833:
.#..#.##..
#.........
.........#
.#.###.#.#
##..####.#
.....#.#.#
...#.#....
.#...#....
#.........
..####..##

Tile 3019:
#....##..#
.....#...#
#..#..#.#.
..##.....#
..####...#
###...##..
#.#...##..
..##...#.#
.....##...
#.##...#..

Tile 3061:
.#...#..#.
....###...
....###.##
...#.#....
....#.#...
.....##...
#.......##
..#.##.#..
#.#....#..
###..##..#

Tile 2593:
#...####.#
...##..###
.....#.#..
#...##..#.
#..##.....
..........
#.......##
#...#....#
..#..#....
.#.#####.#

Tile 2617:
......###.
..#...#..#
.#...#...#
....#.....
#.....##.#
.#.....##.
..##......
..#.#....#
##.......#
##.##.##..

Tile 1823:
#####....#
....#...##
........##
.......###
..........
###.#.....
.......#.#
..#...#.#.
........#.
##.......#

Tile 3191:
.#.#..#.##
...#......
..#......#
#.#......#
...#...###
....##.#..
..###....#
#..#.#.#..
##.....#.#
#..#####..

Tile 3371:
###.##..##
.#..#..#..
....#.....
.......#..
.........#
#..##.....
.....##.#.
.##.##.#..
#........#
#.###..#..

Tile 1721:
.#.##.##..
##..#...#.
##........
#....###.#
..#.#...#.
.#.......#
#.....##..
#.......##
.#..#...#.
##.##.#..#

Tile 3011:
#.##.#.###
..........
.....##...
........##
#..#......
.#......#.
.......#..
#........#
#...#.....
......####

Tile 1801:
#.#.#.####
#..#.#....
.#...#..#.
.##...#..#
##........
#.#.##..##
##..#.....
#...#....#
##.##...#.
#######.#.

Tile 1129:
.###.##.##
.....#...#
.#........
##...#....
###..#.###
##........
#.###....#
.#......#.
......#...
#....#..#.

Tile 3517:
#..#.#..##
#.....#.##
...#.#...#
#..#.....#
##.#.....#
.#.....#.#
.##.###...
..........
#....#..#.
.######..#

Tile 3607:
##..#.#.##
#....#...#
#..##.....
.........#
..#.......
#...#.....
#....#..##
#....##...
#..#.#.#..
..########

Tile 2803:
..##.#.##.
...##....#
....#....#
..#..#.#.#
#..##.....
#....##..#
.....#...#
#...#.....
#...#.....
.#.#.#.#.#

Tile 3331:
.#####....
#.........
.#..#.....
....#.....
#......#..
#.......#.
...#.#....
#.........
#.......##
#.#..#####

Tile 3499:
#...#.#..#
.#........
#...####.#
.#..###...
#..##.##.#
.##.......
..........
....#..#.#
...###...#
..#....###

Tile 3299:
.......##.
..#.#.....
.#.....##.
#.........
..........
##........
#...#..#.#
...##.....
.......#.#
#.##.###.#

Tile 3793:
#.##.####.
#.........
#...#.....
#.#...#..#
#.#..#...#
....##.#..
##...##..#
......#..#
..........
.#.#######

Tile 2657:
#####.##..
##....####
...#.#....
....###.##
#.....#...
..........
#..#.#....
.#...#....
....###...
.#.....#..

Tile 2239:
..###..#.#
#.###.....
#..#.#..#.
#......##.
#.........
..........
#...##....
...#.#.#..
........##
#....#.#.#

Tile 2861:
#...#####.
........##
#.....#.#.
#........#
......#...
##..#..#..
.##......#
.#.##...##
..#......#
.....#.#.#

Tile 1061:
#....###.#
.......#.#
.#..###..#
.....#...#
.........#
#.....#..#
#.#......#
....#.....
##...#...#
#.#.###.##

Tile 1447:
#.###.##.#
#....##..#
#.#...#...
##......##
#.......##
##........
.#.#....##
.....##...
##..##...#
..###.#...

Tile 1997:
.#.#...##.
#....#.#..
..##..#...
#####.....
#....#....
#.........
..#..###.#
..##...#..
#....#.##.
....#..##.

Tile 2251:
..##.#...#
..........
..#....#..
#.#.#.#..#
#.#.....#.
##......#.
#..#.#####
.........#
#....#....
##.#.##.#.

Tile 3797:
####.#.###
...##.....
......#...
#....#..##
..#..###..
.#.....##.
#......##.
..###.....
.##.....##
..##.##.##

Tile 1669:
.#.#..#..#
#...#.....
#.#.......
#......###
#.....##.#
....#....#
.....#..##
...#..#..#
.....#....
###.#.....

Tile 2939:
#..#.###.#
#........#
###....#..
###...##..
#.##.#..##
.##..#....
#.......##
#.#...#..#
##......#.
..##...###

Tile 2411:
###..#.#.#
#...##....
##...#...#
.#.#..#...
#.....#...
#.#.##....
.......#.#
.###......
##...#.###
##.#.#.#.#

Tile 3469:
#.#..#...#
.........#
#.........
##.#####.#
......#...
..........
#........#
...#.....#
#........#
#..#.....#

Tile 2677:
.#.#.#..##
#...#.#..#
..........
...#..#..#
..........
..........
##.#.....#
#........#
#.....##.#
##.#..##..

Tile 3361:
.#..#...##
#.#....#..
...####...
.#...#...#
#..#....#.
#........#
#.##.....#
.#...#..##
##.....#..
##.....#.#

Tile 1567:
#...#.###.
#.#.#.....
#.###.#..#
..........
......#.##
#.........
.#...##...
###.##...#
#..#....#.
..###..#.#

Tile 1153:
##.#..##.#
####..#..#
#.........
....#...#.
#...#..#..
#........#
.#......#.
#......###
....####..
###...#.##

Tile 1063:
#.###..##.
.......#.#
......##.#
...#..#.##
#.....#.#.
.....#....
......#..#
.#......#.
#.......#.
#...#.####

Tile 3643:
#.#.##....
......##.#
#.....#...
.....##.##
#....##.##
......#...
.##....#.#
#..#...#..
..........
#...###.#.

Tile 2161:
####.###..
..#...###.
##.......#
#....#...#
#.....###.
..........
...#....#.
##......#.
......##..
#.#..####.

Tile 1373:
#########.
.#.#.....#
..........
#..#...#.#
#....#....
#....#..#.
..#.......
#.......##
#..#..###.
##...#....

Tile 2237:
.#..#...##
#..#.....#
#......#.#
....#..#..
.....#....
#..#.....#
###.......
#...#.....
#.........
##...#.#..

Tile 3319:
.##.####..
#.....#...
#..#......
.......#..
..........
#.#......#
#.....#...
#.##......
....#.#..#
#...#.##.#

Tile 1931:
###.....#.
...##.....
.........#
....#.#.#.
.....#....
....#.#...
##.......#
#....#.#.#
..........
####.#...#

Tile 2753:
#..##.....
.#.......#
#.....#...
.#.....#.#
##..#..#..
....#.#...
##.#.....#
.##..#....
......#...
.#......##

Tile 2273:
.#.######.
.#..#....#
#..#.##...
.#...##..#
..#.##....
#....#....
#...###.##
#...#....#
#......###
#.#.####.#

Tile 2131:
..#.##.#.#
........##
#.#..#...#
......#..#
#.....#..#
..........
.........#
...#.#..##
#.#.......
#.##.##..#

Tile 1259:
#....#.###
#........#
#...#.#..#
.#.#...#.#
...#.#...#
.#..#..#..
......#...
.#....####
#.....##..
.#.#.##..#

Tile 2837:
##.....###
#.#..#..##
#..##....#
#.........
#.........
#..#.#.#..
#.........
......##.#
#.......#.
##.###...#

Tile 3467:
#.#.##..##
#.#.#.#..#
#.#......#
##.#.....#
.......#.#
.#....####
.......#.#
#.#....#.#
....#..#..
#...##....

Tile 3833:
..#.###.##
#....###.#
#....#.#..
##......##
.........#
.........#
#...##..##
#......#..
#..#...#..
##.#.##.##

Tile 1559:
###.##..#.
#..####..#
.....##.##
#..#.....#
..........
#..###....
.#..#..#..
#.##..#.#.
#..#.#....
##.#....##

Tile 1483:
#.#.###..#
#..#...#.#
#.....#.#.
#........#
#...#..#.#
#.#..##.#.
#.#.##...#
......#.##
.....#..##
#.#.#.##.#

Tile 2711:
...###..#.
#..#......
........##
#.#...#..#
#.....#...
...#.##..#
#.........
##.##.....
#....#..#.
#.#####.##

Tile 1321:
...#.####.
....#...##
...#.#..#.
###....#.#
#....#.#..
#....#.#.#
..#....#.#
#.........
#...#....#
#.#..#.###

Tile 1637:
#.#...###.
.#......#.
#..#..#.#.
.#........
.#......##
####.....#
#.##.....#
###..#....
.##..#...#
##....####

Tile 2687:
..##....##
.#.....#.#
.#....#.##
#.#..#...#
...#.....#
#...#.....
#......##.
##.#..##.#
..##.#..##
###.######

Tile 2543:
...#####.#
#.#...#...
.......#..
.#..#.#.##
.#.#......
###..#...#
#..##...##
#.#.#.##..
.....#...#
#...#..##.

Tile 1487:
...#..###.
....#....#
...#...#..
##..#.#.#.
...#...#..
...#.#.#.#
#.........
#..##.#...
.#.#......
#...##.#.#

Tile 3929:
#.#.#.#.##
.#.##..#..
...##....#
....#.....
.....#...#
.#.#....##
.#..#.....
#..#......
##....#...
.#.###.#.#

Tile 3617:
##.##...#.
#..#..####
#.........
#..#....##
...#.....#
.#.......#
..#.......
.##..#...#
.##......#
#......##.

Tile 1069:
#.#.#...#.
##.#...###
##.......#
...#...#.#
#.#.....#.
#..#..#..#
#.###..#.#
#.##..##.#
.#......##
.#.###.##.

Tile 3863:
.#.#.....#
..#.#..#..
...#.#..#.
.....##...
#........#
#......##.
...#....##
.......###
....#.....
#####..###

Tile 1847:
.###.#....
#........#
#........#
#.#.#.....
##..#.#..#
#.....#..#
..#.#..#..
##...#.#..
#........#
###.#...##

Tile 1831:
.#.##.#..#
..#.#..###
#.#.......
#.........
.....#....
#.........
#....#..##
#......##.
#....#...#
...#..###.

Tile 3697:
....###..#
##.#..#..#
#.#...####
#.......#.
#.##.#....
#..#......
#.........
...#.....#
#.........
.######.##

Tile 1433:
..##.#.#.#
..#.....##
......##..
...#..##.#
....##....
#.#.#..#.#
....###...
#.........
..#...#...
.#.##....#

Tile 1987:
..##......
..#..#..#.
.........#
.....#....
..##.....#
.........#
....##...#
#......##.
#........#
..####..##

Tile 2389:
#.#.####.#
#.....#...
#....#....
#....#....
#...#.#..#
##.#...#..
.........#
#.....#...
#.#..#....
..##..####

Tile 3917:
.##.##....
#.#.....##
..#..#..#.
.#....####
##.#...#.#
.....#.#.#
........#.
#.###.....
.#........
.###..#.##

Tile 3533:
#.#...#.##
#.........
#.........
###.##....
.#.#..#.#.
..........
#....#...#
#...##...#
..#.##..##
..###.#.##

Tile 1471:
#...##..##
.#.##...#.
#.#.......
.......#..
#.#......#
#..##..#..
###....###
..#.#...#.
##......#.
.####.###.

Tile 1051:
#.#.##.##.
###....#.#
....#...##
..#...####
#.....####
#........#
#..#..#..#
#......##.
#...#.#.##
####.#..##

Tile 3407:
#.#..#.#.#
#........#
..#..##...
......#...
#.........
...#.....#
#.##..##.#
.......#..
#.......##
.....###..

Tile 3853:
###...#.##
#.........
.....##..#
..#......#
.....#...#
....#...#.
....#.....
#........#
.........#
.##.##..##

Tile 3079:
.#.#..###.
.....##...
.....###..
#....#.#..
#.#.##...#
#......#.#
#.....#..#
#........#
.##.#..###
#.#..##.#.

Tile 3449:
...##.#.##
.#...#....
#.......##
##.#.....#
#...#.#..#
..#.#....#
.#.......#
..#....#.#
...#.....#
..#.###.#.

Tile 2203:
..#.###...
#..#.....#
#.##.#..#.
........##
...#...#.#
.........#
#..#..##.#
#..##.###.
...#...#..
...###.###

Tile 3067:
#.####.##.
.....#...#
#..##...##
#.#......#
##..#..#.#
###...#...
..#.....##
..#......#
#.......##
#.#.#...##

Tile 3947:
...#......
###.......
.#...#..#.
#..#.....#
#.#.......
.##.......
.......#..
.#.#...###
.#.....#.#
.#......##

Tile 1091:
.##...##.#
.#.#....##
.........#
#........#
.#.......#
#.......##
#.........
.#......##
....#..###
..#...##..

Tile 1201:
.##.#....#
#......###
..#.#..#.#
#.....#..#
.#.#.##.##
##..#.##..
.#......##
##....#..#
..........
##.###....

Tile 2281:
##.#.....#
.#..#...#.
.#.....#..
##..#.#..#
#.#.#....#
..........
..##.#...#
.#...##..#
#...#.#...
###.#..###

Tile 3229:
#...###.##
##........
..##.#.###
.#.#..####
#.#.....##
...#......
#.#.#.#..#
#....#.###
#.....#.#.
#.##.##...

Tile 3739:
###.###.#.
#..#....##
#...#....#
.....#.#.#
.....#..##
..........
##.#.....#
###..#.#..
...#..#...
.#.....#.#

Tile 2069:
.##.#.####
#...#..#.#
...##.....
#...#.....
.##.......
#...#....#
.#....#..#
.#......##
#.....#..#
..#.##.#.#

Tile 2399:
####.#.#..
.#....#..#
#........#
#.#.##...#
.#....####
##.#...#..
#..#.##.#.
...#.#.#..
##.##..#..
##..#..###

Tile 2087:
..#..#....
..##.....#
#.#.......
###.......
...#...#..
..#.......
##....##..
#.#..##.##
..#.#.....
###...##.#

Tile 3203:
.#.##..#.#
#..##....#
#.......#.
#..#......
....##.##.
..........
..#..#...#
.#....##..
.....#.###
#.###..#..

Tile 3631:
#####.####
#.#..#...#
##......##
#.#..##..#
.#......#.
#.#...#...
....#....#
#.....##..
....##....
##..#...#.

Tile 1291:
.####..###
#...#.#...
.....#..##
#..#.##.#.
.##.......
....#....#
.........#
.#....#.#.
......#...
#...#...##

Tile 2377:
....#..#..
#...#..#.#
#...#.....
#........#
.....#....
##.......#
##........
#....#.##.
#..##....#
###..#....

Tile 1223:
##.#.###.#
#..#..#..#
.........#
#.#.......
...#......
...#...#..
#.#.......
.##.####..
...##.#..#
#.#..##.##

Tile 3343:
..#..#..##
.....##..#
#.....#...
.#.....#.#
....#..#..
........#.
.#.#..###.
##...##...
#..#..#..#
#....#..##

Tile 3001:
.#..#..#..
##.#....#.
#.#......#
.....##...
#..#..#...
..#.#..###
...#......
...#...#.#
.#...#...#
##.##.###.

Tile 3881:
.#...####.
#....###..
.#..#..#.#
...#.....#
#..#......
#...#...##
.#.####.##
#...#.#..#
.#........
#.#.###.##

Tile 2897:
#...#..#.#
........##
....#..#.#
#....##..#
....#...#.
......#.##
#.##.....#
.....##..#
.........#
.#..#.....

Tile 2819:
#......#.#
#...##....
.......#..
#..#......
...##..#.#
#........#
#........#
#..#..#..#
.#.##.##.#
#..###....

Tile 1597:
#######...
#.###....#
...###..#.
#.....#..#
..........
..#......#
#...###.##
#........#
.#.....#..
..#..#.##.

Tile 3461:
#.#..#..#.
...#..#..#
###.#.#...
.#..##....
..##.....#
.....#....
.........#
...#......
#...#....#
#.##.##.##

Tile 2843:
.#########
.........#
#.........
...#..##..
...##....#
..........
#..##....#
#.##......
.#.#..##..
..###.#.##

Tile 2309:
.#.#...##.
#.......##
.......#..
...#..#..#
.###...##.
##........
....#....#
#.#..#....
#.#..#..##
#...##.###

Tile 1951:
#..###..##
#...#..###
...###...#
##...###..
#.#......#
..#.##....
...#..##.#
##......#.
...#...###
.#.#.##..#

Tile 2027:
####.##..#
..#..#....
#.#......#
...#......
##.#.....#
...#...##.
#..#......
#.##...#.#
..#...##.#
.###......

Tile 1097:
.##.#.##..
..#..#.##.
...#..#...
#........#
##.#....#.
#...#..###
..#......#
#.........
..#......#
....###...

Tile 1181:
.###..####
#...##..#.
#.##.#..#.
#...#...#.
#...#.....
.#.....#.#
.........#
##........
....#....#
#..#.##..#

Tile 3637:
..####...#
.........#
#..##.#.#.
#...#...##
...###...#
...#.....#
..##.....#
..##..##..
#..#...#..
#.#...####

Tile 2957:
#####.####
.#....#...
.....#....
#..#..##.#
...#.##..#
#.....#.#.
.....#..##
#####....#
#..#.#...#
###..#...#

Tile 1381:
#.#...###.
..#..#..##
....#.#.#.
#....#.#.#
.###......
#....##...
#...#..#..
..#..#..#.
........#.
#.#.##..#.

Tile 2699:
..##.####.
..#..###.#
.#......#.
....#.#..#
.#..#....#
..##..##..
#.....#..#
###......#
#.#.###...
########.#

Tile 2333:
..#..#..##
.#....#.##
.....#....
...#.##...
#........#
....##..##
#....#.#.#
#.........
..#..#.##.
######.#.#

Tile 2467:
.##..#.##.
##...#....
........#.
..#..#..#.
##..####..
.#..#.#..#
..........
...#...#.#
.#........
.#..#.#...

Tile 1123:
#.######..
..#.#.....
.........#
#.........
....#..#.#
.....#..##
.....#....
#..###...#
#.#.##...#
##...#.###
"""

let pattern = """
                  #.
#    ##    ##    ###
 #  #  #  #  #  #...
"""
// Manually padding the pattern a bit because Xcode likes to remove trailing whitespace

struct Point: Hashable {
	var x: Int
	var y: Int
}

extension Array where Element == Array<Bool> {
	mutating func rotate() {
		var newData: [[Bool]] = Array(repeating: [], count: self[0].count)
		for row in self.reversed() {
			for (index, item) in row.enumerated() {
				newData[index].append(item)
			}
		}
		self = newData
	}
	
	mutating func flip() {
		self = self.map { $0.reversed() }
	}
}

extension StringProtocol {
	var integers: [Int] {
		return self
			.split { "-0123456789".contains($0) == false }
			.map { Int($0)! }
	}
}

struct Tile: Hashable {
	let id: Int
	var data: [[Bool]]
	
	var topEdge: [Bool] { data.first! }
	var bottomEdge: [Bool] { data.last!.reversed() }
	var rightEdge: [Bool] { data.map { $0.last! } }
	var leftEdge: [Bool] { data.map({ $0.first! }).reversed() }
	
	var edges: Set<[Bool]> {
		[topEdge, rightEdge, bottomEdge, leftEdge]
	}
	
	var allPossibleEdges: Set<[Bool]> {
		edges.union(edges.map({ $0.reversed() }))
	}
	
	mutating func rotate() {
		data.rotate()
	}
	
	mutating func flip() {
		data.flip()
	}
	
	func isNeighbour(of otherTile: Tile) -> Bool {
		allPossibleEdges.isDisjoint(with: otherTile.allPossibleEdges) == false
	}
	
	func canBeAlignedWith(_ otherEdge: [Bool]) -> Bool {
		allPossibleEdges.contains(otherEdge)
	}
}

let tiles = input
	.components(separatedBy: "\n\n")
	.map { text -> Tile in
		let lines = text.split(separator: "\n")
		let id = lines[0].integers[0]
		let data = lines.dropFirst().map { line in
			line.map { $0 == "#" }
		}
		return Tile(id: id, data: data)
	}

func partOne() -> String {
	tiles
		.lazy
		.filter { tile in
			let neighbours = tiles.lazy.filter { $0.isNeighbour(of: tile) }
			return neighbours.count == 3
		}
		.map(\.id)
		.reduce(1, *)
		.description
}
func partTwo() -> String {
	
	let topLeft = tiles
		.lazy
		.compactMap { tile -> Tile? in
			let uniqueEdges = tile
				.allPossibleEdges
				.lazy
				.filter { edge in
					tiles
						.map(\.allPossibleEdges)
						.filter { $0.contains(edge) }
						.count == 1
				}
			
			guard uniqueEdges.count == 4 else { return nil }
			
			var tile = tile
			while uniqueEdges.contains(tile.topEdge) == false {
				tile.rotate()
			}
			if uniqueEdges.contains(tile.leftEdge) == false {
				tile.flip()
			}
			return tile
		}
		.first!
	
	var tilesCopy: [Int: Tile] = [:]
	tiles.forEach { tilesCopy[$0.id] = $0 }
	
	var board: Set<Point> = []
	var currentTile = topLeft
	var currentPosition = Point(x: 0, y: 0)
	
	while tilesCopy.isEmpty == false {
		tilesCopy.removeValue(forKey: currentTile.id)
		
		currentTile.data.dropFirst().dropLast().enumerated().forEach { y, row in
			row.dropFirst().dropLast().enumerated().forEach { x, item in
				guard item else { return }
				board.insert(Point(x: x + currentPosition.x, y: y + currentPosition.y))
			}
		}
		
		if var candidate = tilesCopy.values.first(where: { $0.canBeAlignedWith(currentTile.rightEdge) }) {
			let edgeToCompare = Array(currentTile.rightEdge.reversed())
			
			if candidate.edges.contains(edgeToCompare) == false {
				candidate.flip()
			}
			
			while candidate.leftEdge != edgeToCompare {
				candidate.rotate()
			}
			
			currentTile = candidate
			currentPosition.x += currentTile.data.count - 2
		}
		else if var candidate = tilesCopy.values.first(where: { $0.canBeAlignedWith(currentTile.leftEdge) }) {
			let edgeToCompare = Array(currentTile.leftEdge.reversed())
			
			if candidate.edges.contains(edgeToCompare) == false {
				candidate.flip()
			}
			
			while candidate.rightEdge != edgeToCompare {
				candidate.rotate()
			}
			
			currentTile = candidate
			currentPosition.x -= currentTile.data.count - 2
		}
		else if var candidate = tilesCopy.values.first(where: { $0.canBeAlignedWith(currentTile.bottomEdge) }) {
			let edgeToCompare = Array(currentTile.bottomEdge.reversed())
			
			if candidate.edges.contains(edgeToCompare) == false {
				candidate.flip()
			}
			
			while candidate.topEdge != edgeToCompare {
				candidate.rotate()
			}
			
			currentTile = candidate
			currentPosition.y += currentTile.data[0].count - 2
		}
	}
	
	let boardSize = Point(x: board.map(\.x).max()!, y: board.map(\.y).max()!)
	
	func monsterCount(forPattern pattern: Set<Point>) -> Int {
		let patternSize = Point(x: pattern.map(\.x).max()!, y: pattern.map(\.y).max()!)
		let range = Point(x: boardSize.x - patternSize.x, y: boardSize.y - patternSize.y)
		
		var count = 0
		
		for y in 0 ... range.y {
			for x in 0 ... range.x {
				let adjustedPatternPoints = pattern.map { Point(x: $0.x + x, y: $0.y + y) }
				if board.isSuperset(of: adjustedPatternPoints) {
					count += 1
				}
			}
		}
		
		return count
	}
	
	let initialPatternData = pattern
		.split(separator: "\n")
		.map { line in
			line.map { element in
				return element == "#"
			}
		}
	
	var maxMonsterSize = 0
	
	for isFlipped in [false, true] {
		for rotations in (0 ... 3) {
			var patternData = initialPatternData
			
			if isFlipped { patternData.flip() }
			for _ in 0 ... rotations { patternData.rotate() }
			
			let patternPoints = patternData
				.enumerated()
				.reduce(into: Set<Point>()) { set, yAndLine in
					let (y, line) = yAndLine
					line.enumerated().filter({ $0.element }).forEach { x, _ in
						set.insert(Point(x: x, y: y))
					}
				}
			
			let monsterSize = monsterCount(forPattern: patternPoints) * patternPoints.count
			maxMonsterSize = max(maxMonsterSize, monsterSize)
		}
	}
	
	return (board.count - maxMonsterSize).description
}

print(partOne())
print(partTwo())
