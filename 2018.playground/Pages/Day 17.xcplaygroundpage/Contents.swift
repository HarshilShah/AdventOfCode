//: [Previous](@previous)
import Foundation

let input = """
y=236, x=455..474
y=848, x=449..465
x=495, y=325..337
x=550, y=1000..1027
x=450, y=324..332
x=542, y=165..170
y=1414, x=490..496
y=83, x=493..496
y=258, x=466..485
x=510, y=1733..1742
x=448, y=861..866
x=435, y=198..220
x=571, y=432..435
x=583, y=620..630
x=556, y=63..82
y=812, x=480..499
x=529, y=398..399
x=542, y=1079..1097
y=680, x=555..573
x=537, y=589..591
y=128, x=498..518
y=618, x=556..561
x=523, y=1734..1742
x=518, y=114..128
x=430, y=387..398
x=418, y=1144..1167
x=418, y=356..376
y=1630, x=417..438
x=477, y=91..101
x=507, y=1258..1269
x=475, y=1533..1547
x=415, y=794..797
x=454, y=782..785
y=722, x=503..512
x=421, y=1708..1712
y=373, x=571..576
x=561, y=151..172
x=427, y=1658..1672
x=407, y=502..522
x=471, y=345..358
y=919, x=538..540
x=539, y=1014..1035
x=550, y=185..195
y=590, x=422..444
x=489, y=1191..1200
x=572, y=1168..1186
y=568, x=521..524
x=573, y=670..680
x=499, y=1255..1266
x=452, y=507..510
y=658, x=447..451
x=489, y=902..911
x=479, y=1108..1120
x=461, y=326..337
x=500, y=955..961
y=1525, x=461..466
x=508, y=51..64
y=740, x=459..466
x=578, y=152..172
x=465, y=85..105
x=431, y=415..428
y=207, x=473..475
x=578, y=1184..1193
x=471, y=326..337
x=499, y=298..300
x=409, y=912..921
x=456, y=159..173
x=524, y=258..267
x=453, y=1308..1334
x=418, y=524..540
x=554, y=207..220
x=496, y=582..593
x=447, y=414..428
x=577, y=513..517
x=512, y=651..661
x=500, y=1279..1291
x=462, y=1599..1619
x=455, y=840..842
x=462, y=1256..1263
x=451, y=547..555
x=519, y=1205..1228
x=432, y=841..859
x=436, y=1028..1037
x=463, y=1357..1374
y=723, x=571..574
x=482, y=1382..1395
x=574, y=1443..1459
y=1692, x=534..537
x=540, y=602..612
x=556, y=1079..1097
x=420, y=911..921
y=105, x=465..474
x=484, y=180..191
x=576, y=370..373
y=1564, x=563..584
x=534, y=1686..1692
x=568, y=443..455
y=1223, x=476..501
y=1629, x=500..524
x=555, y=738..756
x=449, y=775..788
x=489, y=1257..1269
y=517, x=572..577
x=420, y=252..257
x=491, y=582..593
y=1335, x=548..569
y=1754, x=535..538
y=276, x=577..580
y=1755, x=456..473
x=438, y=1185..1187
x=559, y=1209..1224
x=506, y=1220..1222
y=687, x=439..452
x=421, y=1414..1420
x=556, y=1370..1373
x=430, y=723..741
x=582, y=1183..1193
x=557, y=1403..1427
y=429, x=419..427
x=489, y=1567..1575
y=403, x=425..445
y=793, x=570..580
y=741, x=430..439
x=545, y=1682..1696
y=531, x=484..504
x=577, y=269..276
y=743, x=450..472
x=530, y=589..591
x=542, y=1308..1324
x=437, y=920..934
x=561, y=1569..1576
x=515, y=12..22
y=1576, x=555..561
y=101, x=428..431
x=549, y=629..631
x=509, y=9..18
y=332, x=447..450
x=485, y=331..333
x=505, y=549..551
y=445, x=444..453
x=569, y=529..537
x=420, y=1027..1037
x=428, y=1008..1022
y=522, x=533..557
y=1492, x=522..524
x=553, y=407..424
x=478, y=1472..1482
x=536, y=1110..1116
x=488, y=74..86
x=550, y=720..738
y=573, x=430..449
x=460, y=38..62
y=1514, x=551..560
x=455, y=1221..1228
y=1279, x=535..554
x=440, y=524..540
y=192, x=563..578
x=533, y=1577..1588
x=506, y=1180..1188
x=419, y=427..429
x=516, y=94..105
x=428, y=329..343
x=522, y=258..267
y=1461, x=454..468
x=508, y=1150..1162
x=444, y=1376..1399
x=564, y=1111..1116
x=542, y=362..364
x=533, y=967..979
y=1077, x=571..579
x=532, y=562..571
y=998, x=439..454
y=616, x=530..546
y=785, x=454..486
y=243, x=504..506
x=447, y=241..245
x=572, y=1001..1027
x=496, y=1409..1414
x=564, y=5..17
x=582, y=128..138
x=426, y=1095..1098
x=518, y=48..58
x=486, y=782..785
y=1041, x=459..522
y=1514, x=422..446
x=524, y=1560..1564
y=591, x=530..537
y=1427, x=549..557
x=452, y=15..32
y=62, x=495..497
y=1203, x=424..435
x=538, y=602..612
y=267, x=522..524
x=471, y=312..314
x=436, y=24..47
x=533, y=518..522
x=530, y=1507..1524
x=490, y=797..808
y=1459, x=574..580
x=561, y=648..661
y=172, x=561..578
y=1168, x=451..455
y=1546, x=441..457
x=497, y=1564..1582
x=430, y=330..343
x=435, y=1189..1203
y=753, x=531..534
x=521, y=1165..1173
x=538, y=854..868
x=520, y=48..58
y=424, x=553..578
y=893, x=451..496
x=452, y=477..491
y=22, x=499..515
y=1439, x=499..507
x=558, y=185..195
x=563, y=227..230
y=278, x=512..527
x=513, y=943..953
x=456, y=457..465
y=1528, x=451..475
x=441, y=1051..1053
x=468, y=1449..1461
x=442, y=1113..1116
x=511, y=1234..1248
x=466, y=273..276
x=478, y=1425..1439
y=1532, x=434..436
x=534, y=550..552
y=314, x=471..477
y=428, x=431..447
y=1303, x=447..457
x=542, y=1358..1379
x=504, y=1321..1335
x=555, y=1569..1576
x=560, y=1454..1470
y=1685, x=559..562
x=562, y=716..729
x=410, y=1107..1120
y=170, x=518..542
x=466, y=247..258
y=510, x=447..452
x=558, y=967..972
y=405, x=498..500
x=506, y=243..245
x=519, y=945..959
x=549, y=1404..1427
y=1372, x=495..513
y=267, x=549..566
x=566, y=312..337
x=572, y=127..138
y=898, x=514..527
x=462, y=438..450
x=574, y=1381..1402
x=466, y=1184..1187
x=448, y=1701..1720
y=1507, x=466..488
y=630, x=564..583
y=47, x=424..436
x=452, y=666..687
x=446, y=1377..1399
x=512, y=1449..1477
y=1128, x=551..563
y=1238, x=405..417
y=1588, x=515..533
x=439, y=987..998
x=467, y=1008..1022
x=417, y=1222..1238
x=518, y=1143..1153
y=700, x=471..586
x=484, y=562..574
x=562, y=1695..1709
x=480, y=904..915
x=568, y=111..129
y=1096, x=405..422
x=492, y=1506..1528
x=572, y=514..517
y=484, x=465..468
x=461, y=608..636
y=636, x=459..461
y=421, x=438..440
x=474, y=160..173
x=434, y=438..450
y=1737, x=544..564
y=192, x=509..514
x=579, y=461..474
y=356, x=563..573
x=412, y=120..144
x=483, y=331..333
x=446, y=292..302
y=1524, x=530..542
x=459, y=733..740
x=562, y=1671..1685
y=953, x=511..513
x=513, y=1599..1610
x=569, y=1208..1224
y=86, x=488..508
x=530, y=605..616
x=572, y=1103..1118
x=499, y=800..812
x=484, y=521..531
x=472, y=1310..1316
x=441, y=819..829
x=522, y=1469..1492
y=419, x=472..493
x=441, y=1536..1546
x=526, y=1575..1583
x=468, y=1063..1075
x=561, y=593..618
x=580, y=768..793
x=415, y=287..296
x=528, y=1560..1564
x=478, y=251..253
x=546, y=604..616
x=555, y=1237..1259
x=501, y=375..383
y=593, x=491..496
x=532, y=1703..1715
y=952, x=558..582
x=504, y=366..368
x=501, y=1210..1223
x=492, y=237..248
y=1368, x=419..433
x=573, y=462..474
y=113, x=521..524
y=1190, x=534..544
x=472, y=405..419
y=216, x=520..528
y=829, x=441..457
x=516, y=1053..1080
x=521, y=1180..1188
x=559, y=625..636
x=530, y=1398..1415
y=1139, x=476..487
x=566, y=247..267
x=535, y=442..449
x=544, y=1238..1259
x=500, y=159..179
x=450, y=861..866
x=498, y=402..405
x=534, y=1174..1190
y=1457, x=459..462
x=537, y=1053..1080
y=1027, x=550..572
x=536, y=784..797
x=467, y=1233..1239
x=505, y=297..300
y=357, x=407..409
x=525, y=1440..1461
x=554, y=1289..1303
x=486, y=1005..1021
x=486, y=1483..1484
x=540, y=916..919
y=842, x=455..459
x=533, y=357..373
y=1324, x=540..542
y=555, x=430..451
y=219, x=576..580
x=488, y=1493..1507
x=455, y=1166..1168
x=433, y=1128..1152
y=995, x=490..502
y=1366, x=502..505
x=544, y=1748..1758
y=820, x=538..546
x=579, y=1056..1077
x=527, y=543..555
x=529, y=1205..1228
x=422, y=1087..1096
y=245, x=504..506
y=1724, x=504..526
y=306, x=417..419
x=445, y=966..979
y=430, x=532..547
y=333, x=483..485
x=538, y=1746..1754
x=535, y=200..207
y=82, x=535..556
y=934, x=437..517
x=570, y=768..793
x=555, y=1324..1326
y=92, x=549..568
x=513, y=1405..1417
y=1377, x=425..427
y=1477, x=506..512
x=444, y=39..62
y=379, x=445..464
y=1715, x=405..427
x=443, y=1487..1498
x=508, y=73..86
x=421, y=502..514
x=439, y=722..741
x=462, y=1164..1175
x=442, y=137..142
x=520, y=1321..1335
y=586, x=405..416
x=535, y=1274..1279
x=466, y=1523..1525
x=473, y=820..847
x=431, y=74..101
y=491, x=432..452
x=564, y=1134..1135
y=517, x=516..524
y=105, x=501..516
x=551, y=1169..1186
x=534, y=458..475
x=541, y=881..899
x=415, y=986..998
x=544, y=772..796
x=412, y=833..837
y=1618, x=444..456
x=407, y=120..144
x=498, y=1389..1392
x=560, y=1492..1514
x=518, y=541..554
x=535, y=62..82
x=446, y=1209..1215
y=571, x=505..532
x=527, y=1596..1605
x=439, y=667..687
x=549, y=248..267
x=514, y=974..976
y=979, x=509..533
x=497, y=91..101
x=554, y=1133..1135
x=470, y=1210..1215
y=398, x=430..438
y=868, x=532..538
x=425, y=389..403
x=498, y=644..650
y=1419, x=444..464
y=1633, x=456..469
y=1395, x=482..504
x=483, y=1309..1316
y=1379, x=542..549
x=466, y=164..167
x=487, y=1134..1139
x=474, y=223..236
x=441, y=797..810
x=405, y=526..537
x=485, y=348..356
x=546, y=1144..1153
x=441, y=1384..1389
x=510, y=1071..1085
x=492, y=902..911
y=224, x=569..578
x=432, y=690..694
y=1402, x=567..574
x=545, y=1638..1653
y=555, x=527..547
x=436, y=1465..1475
y=1614, x=427..429
x=422, y=251..257
x=446, y=475..487
x=413, y=155..163
x=550, y=497..507
x=526, y=50..64
y=129, x=566..568
y=343, x=428..430
x=485, y=641..660
x=492, y=797..808
y=368, x=504..527
x=579, y=862..887
x=550, y=1454..1470
y=712, x=405..433
x=527, y=985..1000
y=1610, x=513..533
x=574, y=1696..1709
x=454, y=128..144
x=557, y=291..298
x=478, y=478..488
x=444, y=992..995
y=974, x=436..438
y=214, x=465..481
x=537, y=1686..1692
y=1188, x=506..521
x=482, y=820..847
y=97, x=487..491
x=427, y=1610..1614
x=524, y=1164..1173
x=521, y=564..568
y=142, x=417..442
x=487, y=1389..1392
y=974, x=514..527
x=523, y=225..252
x=508, y=675..682
x=554, y=645..658
y=1461, x=525..527
y=1501, x=472..479
x=450, y=730..743
x=493, y=519..527
x=440, y=412..421
x=510, y=1219..1222
x=578, y=175..192
y=658, x=551..554
x=427, y=1703..1715
x=447, y=324..332
y=1727, x=478..499
x=459, y=840..842
y=677, x=463..479
x=504, y=243..245
x=461, y=1308..1334
x=480, y=1194..1196
x=493, y=160..179
y=1346, x=473..486
x=486, y=1338..1346
y=1708, x=414..421
x=566, y=585..608
x=506, y=1449..1477
y=1193, x=578..582
y=995, x=444..447
x=550, y=1290..1303
x=471, y=690..700
y=660, x=485..506
x=419, y=196..218
x=433, y=1245..1257
y=1269, x=545..565
x=516, y=508..517
y=840, x=566..575
x=556, y=552..571
x=417, y=137..142
x=572, y=899..902
y=596, x=482..502
x=413, y=613..641
y=762, x=526..543
x=544, y=362..364
x=543, y=647..661
x=474, y=86..105
x=428, y=1642..1654
x=449, y=838..848
x=514, y=652..661
x=535, y=251..260
y=764, x=464..487
x=487, y=94..97
x=574, y=721..723
y=631, x=544..549
x=424, y=1188..1203
x=405, y=579..586
x=444, y=459..472
x=476, y=1134..1139
x=447, y=507..510
y=124, x=452..466
x=506, y=1639..1653
x=525, y=1596..1605
y=797, x=411..415
y=1715, x=532..554
x=582, y=644..648
x=566, y=111..129
y=608, x=566..572
y=694, x=432..436
x=538, y=624..636
y=1470, x=550..560
y=1325, x=528..533
y=740, x=493..496
x=524, y=297..315
x=526, y=1717..1724
y=738, x=532..550
x=464, y=365..379
y=276, x=464..466
x=493, y=725..740
x=537, y=347..349
x=545, y=1267..1269
x=422, y=177..189
x=528, y=1306..1325
x=561, y=387..389
y=1334, x=453..461
x=513, y=375..383
y=1439, x=462..478
y=475, x=524..534
y=1075, x=416..468
y=42, x=515..534
y=998, x=415..418
y=1544, x=557..559
y=1316, x=472..483
x=575, y=902..921
x=426, y=1045..1056
x=465, y=717..719
x=545, y=282..303
x=507, y=1433..1439
x=552, y=553..571
x=532, y=719..738
x=462, y=1455..1457
y=1037, x=420..436
x=578, y=222..224
x=505, y=1366..1369
x=490, y=1409..1414
x=461, y=307..317
y=1106, x=500..509
y=376, x=418..432
x=424, y=614..641
y=359, x=441..450
x=535, y=387..389
x=578, y=406..424
x=432, y=355..376
y=1373, x=556..582
x=517, y=1558..1569
x=524, y=1618..1629
x=424, y=24..47
y=902, x=569..572
x=509, y=549..551
x=490, y=16..24
x=538, y=809..820
y=1686, x=534..537
y=612, x=538..540
x=538, y=916..919
y=810, x=441..455
x=502, y=503..514
x=429, y=1609..1614
x=543, y=1430..1445
y=1120, x=410..479
x=565, y=528..537
y=465, x=456..458
x=527, y=1441..1461
y=537, x=405..413
x=556, y=592..618
y=24, x=478..490
x=544, y=1727..1737
x=413, y=525..537
x=495, y=52..62
y=1478, x=469..471
y=1559, x=575..578
x=473, y=198..207
x=435, y=619..622
y=1134, x=476..487
x=553, y=1666..1688
y=921, x=409..420
x=461, y=1523..1525
y=472, x=444..464
x=438, y=1624..1630
x=410, y=1270..1284
x=544, y=1174..1190
x=466, y=733..740
x=458, y=1221..1228
x=471, y=1405..1417
x=405, y=706..712
y=1263, x=444..462
x=439, y=475..487
y=1266, x=482..485
y=1259, x=544..555
x=417, y=1251..1253
x=578, y=1557..1559
y=1482, x=545..571
x=578, y=739..756
y=14, x=411..425
x=416, y=1063..1075
x=458, y=858..869
x=498, y=256..263
y=788, x=449..497
y=1251, x=417..424
y=976, x=436..438
x=535, y=1746..1754
x=467, y=872..874
x=407, y=1246..1257
x=457, y=1535..1546
y=1173, x=521..524
x=561, y=442..455
x=531, y=753..758
x=427, y=1372..1377
y=1281, x=438..458
x=460, y=526..542
x=571, y=1057..1077
x=485, y=384..398
y=1182, x=477..495
y=1709, x=562..574
x=451, y=654..658
y=894, x=412..434
x=456, y=1753..1755
x=564, y=672..677
x=513, y=1539..1544
y=712, x=569..578
y=1269, x=489..507
x=512, y=494..508
y=636, x=538..559
x=419, y=945..955
y=979, x=426..445
x=511, y=943..953
y=594, x=525..544
y=18, x=504..509
y=1357, x=507..529
x=434, y=887..894
x=484, y=954..961
x=503, y=389..393
y=1417, x=471..513
x=560, y=672..677
x=549, y=880..899
x=417, y=1624..1630
y=758, x=531..534
y=1684, x=409..416
x=412, y=887..894
x=487, y=752..764
x=558, y=208..220
x=448, y=199..220
y=260, x=535..542
x=575, y=1557..1559
x=454, y=987..998
x=504, y=9..18
x=497, y=390..393
x=515, y=1578..1588
x=415, y=503..522
x=547, y=543..555
y=1135, x=554..564
x=512, y=443..449
y=1445, x=530..543
y=337, x=471..495
y=507, x=550..552
y=1672, x=427..536
x=424, y=1415..1420
x=567, y=292..298
y=43, x=488..508
x=405, y=1145..1167
x=497, y=52..62
x=498, y=115..128
x=416, y=578..586
x=582, y=1369..1373
x=514, y=183..192
x=466, y=114..124
x=466, y=137..150
y=1528, x=440..445
y=1374, x=461..463
y=17, x=564..569
x=576, y=50..70
x=571, y=1666..1688
x=468, y=480..484
x=509, y=736..763
x=498, y=905..915
x=447, y=992..995
y=220, x=435..448
y=817, x=408..421
x=438, y=974..976
x=463, y=661..677
y=682, x=493..508
x=513, y=408..432
x=477, y=1172..1182
y=163, x=413..416
x=479, y=662..677
y=1567, x=489..491
x=525, y=582..594
x=459, y=1471..1482
y=62, x=444..460
y=1284, x=410..422
y=1098, x=426..436
x=475, y=1514..1528
x=486, y=728..740
x=586, y=689..700
y=1523, x=461..466
y=527, x=493..495
y=298, x=557..567
x=425, y=7..14
x=465, y=15..32
x=457, y=818..829
x=512, y=735..763
x=541, y=550..552
x=559, y=1671..1685
x=410, y=288..296
x=459, y=1032..1041
y=1035, x=539..547
x=541, y=226..230
x=532, y=628..630
y=1420, x=421..424
x=445, y=366..379
x=411, y=1572..1591
y=1116, x=536..564
x=437, y=1051..1053
x=464, y=460..472
x=527, y=366..368
x=490, y=971..995
x=456, y=1631..1633
x=567, y=773..796
x=471, y=1475..1478
x=520, y=194..216
x=505, y=348..356
y=1228, x=519..529
y=840, x=455..459
x=557, y=821..848
y=67, x=486..503
x=496, y=71..83
y=191, x=467..484
x=447, y=816..826
x=548, y=1310..1335
x=563, y=1546..1564
x=436, y=1096..1098
y=358, x=454..471
y=251, x=472..478
x=494, y=1132..1143
x=464, y=1409..1419
y=1228, x=455..458
x=525, y=766..776
y=1498, x=443..462
y=179, x=493..500
x=451, y=879..893
x=421, y=814..817
x=559, y=314..319
x=499, y=1712..1727
y=826, x=447..450
x=502, y=1366..1369
x=477, y=312..314
x=440, y=857..869
y=1022, x=428..467
x=549, y=1133..1140
y=317, x=461..483
y=1591, x=411..425
x=517, y=920..934
x=556, y=348..349
y=1696, x=419..545
x=456, y=1128..1152
x=529, y=1345..1357
y=776, x=509..525
x=499, y=11..22
x=564, y=418..420
x=532, y=909..922
x=424, y=1251..1253
y=574, x=484..500
y=195, x=550..558
x=569, y=222..224
y=383, x=501..513
x=583, y=366..388
y=393, x=497..503
x=558, y=1195..1202
x=425, y=1571..1591
x=430, y=841..859
y=150, x=466..529
y=167, x=466..468
x=539, y=1639..1653
y=1392, x=487..498
x=524, y=459..475
y=173, x=456..474
x=512, y=270..278
x=526, y=742..762
x=495, y=1363..1372
x=450, y=816..826
x=422, y=1507..1514
y=661, x=512..514
x=501, y=93..105
y=70, x=565..576
x=473, y=1753..1755
x=580, y=1444..1459
x=551, y=645..658
y=1569, x=517..537
y=1605, x=525..527
x=461, y=1358..1374
x=482, y=1448..1467
x=445, y=390..403
x=487, y=456..477
x=464, y=752..764
y=911, x=489..492
x=490, y=1299..1313
x=492, y=568..571
x=573, y=433..435
x=490, y=823..834
x=462, y=228..231
y=721, x=571..574
y=542, x=454..460
y=296, x=410..415
x=504, y=1716..1724
x=457, y=1290..1303
x=569, y=1310..1335
x=462, y=1488..1498
x=541, y=488..490
x=506, y=495..508
x=538, y=14..37
x=422, y=581..590
x=549, y=1359..1379
y=1187, x=438..466
y=1399, x=444..446
x=558, y=861..887
y=976, x=514..527
x=468, y=164..167
x=513, y=784..797
x=480, y=799..812
x=569, y=898..902
x=493, y=541..554
y=1437, x=421..423
x=407, y=341..357
x=558, y=938..952
y=373, x=533..550
y=849, x=405..421
x=524, y=507..517
x=448, y=1045..1056
x=436, y=689..694
x=548, y=910..922
x=469, y=1632..1633
y=450, x=434..462
x=419, y=1682..1696
x=412, y=755..779
x=463, y=129..144
x=506, y=408..432
x=559, y=790..793
x=534, y=753..758
y=1140, x=545..549
x=424, y=1465..1475
y=1467, x=482..485
y=648, x=570..582
y=189, x=417..422
y=349, x=537..556
y=496, x=533..538
x=573, y=1720..1747
x=405, y=1222..1238
y=1153, x=518..546
y=1053, x=437..441
x=482, y=1194..1196
x=459, y=1455..1457
x=571, y=1476..1482
x=415, y=833..837
y=722, x=460..482
x=533, y=200..207
y=1671, x=559..562
x=438, y=412..421
x=418, y=986..998
x=567, y=488..490
y=1002, x=406..426
x=579, y=1721..1747
x=496, y=725..740
x=485, y=1449..1467
x=522, y=1031..1041
x=569, y=5..17
y=859, x=430..432
x=496, y=879..893
y=719, x=465..473
y=435, x=571..573
y=961, x=484..500
x=459, y=608..636
y=959, x=503..519
y=314, x=555..559
x=482, y=584..596
y=847, x=473..482
x=514, y=872..898
x=533, y=1307..1325
x=447, y=655..658
y=796, x=544..567
y=1167, x=405..418
y=804, x=446..448
x=535, y=627..630
x=502, y=585..596
x=536, y=1658..1672
x=472, y=568..587
y=280, x=425..445
y=319, x=555..559
x=566, y=834..840
x=425, y=256..280
x=578, y=903..921
x=408, y=56..76
y=874, x=467..474
x=557, y=1534..1544
x=437, y=1163..1175
x=575, y=833..840
y=955, x=419..437
y=1371, x=445..456
y=315, x=524..538
y=1528, x=492..509
x=533, y=984..1000
y=782, x=454..486
x=547, y=425..430
x=475, y=198..207
y=837, x=412..415
x=510, y=112..122
y=220, x=554..558
x=444, y=580..590
x=543, y=741..762
y=950, x=424..426
x=572, y=584..608
x=559, y=1534..1544
x=413, y=55..76
y=1369, x=502..505
x=438, y=1296..1317
y=312, x=471..477
y=76, x=408..413
x=462, y=1425..1439
y=399, x=529..550
x=456, y=1346..1371
x=466, y=1493..1507
x=436, y=974..976
x=534, y=33..42
x=485, y=246..258
x=495, y=519..527
x=529, y=136..150
y=144, x=407..412
y=1257, x=407..433
x=493, y=71..83
y=507, x=447..452
x=500, y=1090..1106
y=1290, x=438..443
x=559, y=418..420
x=492, y=1482..1484
x=543, y=1398..1415
x=417, y=300..306
x=497, y=775..788
x=445, y=1523..1528
y=444, x=480..488
x=524, y=564..568
x=473, y=717..719
y=916, x=538..540
x=545, y=1476..1482
x=444, y=443..445
x=557, y=517..522
x=454, y=527..542
x=503, y=54..67
x=405, y=1086..1096
x=426, y=1297..1317
x=409, y=340..357
x=494, y=568..571
x=465, y=200..214
x=405, y=829..849
x=458, y=457..465
x=493, y=675..682
y=1000, x=527..533
x=426, y=942..950
y=779, x=412..416
y=252, x=523..530
x=513, y=1362..1372
y=1415, x=530..543
y=281, x=455..473
x=578, y=705..712
y=540, x=418..440
y=1152, x=433..456
x=438, y=387..398
y=474, x=511..516
y=1097, x=542..556
x=503, y=946..959
x=417, y=1384..1389
x=486, y=1151..1162
x=521, y=86..113
y=356, x=485..505
x=583, y=716..729
x=550, y=356..373
x=456, y=1592..1618
y=1317, x=426..438
x=563, y=1125..1128
x=488, y=1714..1720
x=518, y=166..170
y=683, x=523..528
x=563, y=820..848
x=500, y=402..405
y=1196, x=480..482
x=490, y=257..263
x=468, y=1131..1143
x=493, y=405..419
x=555, y=669..680
y=1118, x=572..582
x=551, y=1124..1128
y=922, x=532..548
x=571, y=721..723
y=1248, x=491..511
y=337, x=442..461
x=438, y=1278..1281
y=1503, x=472..479
x=444, y=1593..1618
x=527, y=974..976
x=538, y=296..315
y=1335, x=504..520
x=508, y=31..43
x=473, y=268..281
y=1175, x=437..462
x=438, y=1287..1290
y=763, x=509..512
x=533, y=486..496
y=641, x=413..424
y=522, x=407..415
x=495, y=1171..1182
x=472, y=251..253
x=460, y=712..722
x=511, y=1539..1544
x=566, y=367..388
x=433, y=1341..1368
y=1582, x=480..497
x=476, y=1209..1223
x=478, y=1711..1727
x=455, y=268..281
x=580, y=199..219
y=37, x=538..560
x=482, y=1253..1266
y=1085, x=501..510
y=1758, x=528..544
y=1222, x=506..510
y=487, x=439..446
x=455, y=798..810
y=630, x=532..535
x=424, y=942..950
x=416, y=1643..1654
y=834, x=490..509
x=544, y=629..631
x=515, y=69..75
y=1186, x=551..572
y=677, x=560..564
y=1266, x=499..501
y=1742, x=510..523
x=467, y=181..191
y=253, x=472..478
y=551, x=505..509
y=418, x=559..564
y=1021, x=478..486
y=388, x=566..583
y=477, x=481..487
x=430, y=547..555
x=443, y=1287..1290
x=422, y=1269..1284
x=466, y=567..587
x=527, y=872..898
x=447, y=1291..1303
x=464, y=273..276
y=1303, x=550..554
x=510, y=1300..1313
x=479, y=1501..1503
y=1215, x=446..470
y=389, x=535..561
x=542, y=250..260
y=1544, x=511..513
x=530, y=225..252
x=545, y=1132..1140
x=491, y=1567..1575
y=921, x=575..578
y=848, x=557..563
x=523, y=1533..1547
x=423, y=1428..1437
x=509, y=184..192
x=446, y=802..804
x=532, y=854..868
y=64, x=508..526
x=509, y=968..979
x=569, y=705..712
y=449, x=512..535
y=488, x=460..478
y=1475, x=424..436
y=729, x=562..583
x=541, y=1195..1202
x=414, y=1708..1712
x=549, y=281..303
x=493, y=1714..1720
x=467, y=228..231
y=245, x=423..447
x=523, y=69..75
y=740, x=479..486
x=554, y=1703..1715
x=556, y=790..793
y=474, x=573..579
x=550, y=397..399
x=408, y=813..817
x=509, y=823..834
x=446, y=1507..1514
x=454, y=345..358
x=504, y=522..531
x=560, y=14..37
x=488, y=31..43
x=537, y=1557..1569
y=300, x=499..505
y=1291, x=476..500
x=469, y=1475..1478
x=480, y=1563..1582
x=486, y=55..67
x=528, y=680..683
y=1583, x=524..526
x=474, y=873..874
x=465, y=293..302
y=589, x=530..537
y=230, x=541..563
x=512, y=720..722
y=364, x=542..544
y=1224, x=559..569
y=587, x=466..472
x=509, y=767..776
y=443, x=444..453
y=756, x=555..578
y=514, x=421..502
y=1653, x=539..545
x=444, y=1256..1263
y=1575, x=489..491
y=207, x=533..535
x=530, y=1431..1445
x=461, y=384..398
x=580, y=268..276
y=432, x=506..513
x=527, y=271..278
x=576, y=199..219
y=1143, x=468..494
y=1162, x=486..508
x=532, y=426..430
x=469, y=1600..1619
x=445, y=1347..1371
y=455, x=561..568
y=554, x=493..518
y=420, x=559..564
y=571, x=492..494
x=449, y=569..573
x=419, y=301..306
y=869, x=440..458
x=564, y=621..630
x=473, y=1337..1346
x=528, y=1749..1758
x=426, y=988..1002
x=564, y=1726..1737
x=523, y=679..683
y=138, x=572..582
y=866, x=448..450
x=472, y=1501..1503
x=454, y=1449..1461
x=462, y=1233..1239
x=551, y=1492..1514
x=567, y=1382..1402
y=887, x=558..579
x=441, y=355..359
x=491, y=94..97
x=584, y=1547..1564
x=434, y=1528..1532
x=445, y=257..280
x=482, y=711..722
x=460, y=477..488
x=409, y=1668..1684
x=544, y=583..594
x=582, y=1103..1118
x=509, y=1089..1106
y=1080, x=516..537
x=549, y=966..972
y=1313, x=490..510
x=451, y=1166..1168
y=1564, x=524..528
x=573, y=341..356
y=75, x=515..523
x=425, y=1371..1377
x=481, y=457..477
x=478, y=1006..1021
x=502, y=970..995
x=552, y=497..507
x=488, y=424..444
x=555, y=314..319
y=508, x=506..512
y=398, x=461..485
y=717, x=465..473
x=419, y=1342..1368
x=509, y=1506..1528
y=1326, x=555..558
y=571, x=552..556
x=465, y=1639..1653
x=417, y=176..189
x=500, y=561..574
y=1720, x=488..493
x=547, y=1013..1035
x=455, y=222..236
x=446, y=1113..1116
x=405, y=1703..1715
x=504, y=112..122
x=491, y=1235..1248
y=122, x=504..510
x=545, y=311..337
x=480, y=425..444
x=485, y=1252..1266
x=501, y=1071..1085
x=448, y=802..804
x=511, y=466..474
y=537, x=565..569
x=430, y=569..573
x=430, y=618..622
x=428, y=75..101
x=426, y=197..218
x=576, y=1612..1628
y=1628, x=558..576
x=501, y=1255..1266
y=490, x=541..567
y=650, x=498..500
y=1547, x=475..523
x=451, y=1515..1528
x=478, y=16..24
x=483, y=307..317
x=563, y=176..192
y=1720, x=438..448
x=515, y=33..42
x=421, y=1427..1437
x=437, y=944..955
y=1747, x=573..579
x=558, y=1324..1326
x=427, y=426..429
y=144, x=454..463
y=808, x=490..492
x=416, y=155..163
y=337, x=545..566
x=542, y=1506..1524
x=512, y=237..248
x=426, y=966..979
x=546, y=808..820
y=899, x=541..549
y=797, x=513..536
y=218, x=419..426
y=552, x=534..541
x=465, y=480..484
y=257, x=420..422
y=263, x=490..498
y=1116, x=442..446
y=1654, x=416..428
y=1653, x=465..506
y=661, x=543..561
x=476, y=1278..1291
y=302, x=446..465
y=1619, x=462..469
x=582, y=939..952
x=442, y=327..337
x=571, y=370..373
y=622, x=430..435
x=416, y=756..779
x=450, y=354..359
y=1253, x=417..424
x=570, y=644..648
y=101, x=477..497
x=507, y=1346..1357
y=793, x=556..559
x=416, y=1667..1684
x=444, y=1409..1419
y=1688, x=553..571
y=1056, x=426..448
x=438, y=1701..1720
x=421, y=829..849
x=524, y=1575..1583
x=440, y=1524..1528
x=528, y=193..216
x=516, y=466..474
y=231, x=462..467
y=58, x=518..520
x=565, y=49..70
y=1239, x=462..467
x=499, y=1434..1439
y=1484, x=486..492
x=540, y=1307..1324
x=436, y=1527..1532
y=1482, x=459..478
x=432, y=478..491
x=411, y=793..797
y=303, x=545..549
y=915, x=480..498
x=468, y=1190..1200
x=563, y=341..356
y=273, x=464..466
x=458, y=1277..1281
x=500, y=1618..1629
x=533, y=1598..1610
y=32, x=452..465
x=568, y=86..92
x=504, y=1382..1395
x=524, y=87..113
y=1202, x=541..558
x=472, y=731..743
x=538, y=485..496
x=524, y=1470..1492
y=1712, x=414..421
x=423, y=242..245
x=433, y=705..712
x=505, y=561..571
x=565, y=1267..1269
y=248, x=492..512
x=411, y=6..14
x=479, y=729..740
y=1200, x=468..489
x=554, y=1274..1279
x=503, y=721..722
x=558, y=1613..1628
y=1389, x=417..441
x=481, y=201..214
x=406, y=989..1002
y=972, x=549..558
x=506, y=640..660
x=452, y=114..124
x=549, y=86..92
x=500, y=644..650
y=1409, x=490..496
x=465, y=837..848
x=453, y=443..445
"""

let testInput = """
x=495, y=2..7
y=7, x=495..501
x=501, y=3..7
x=498, y=2..4
x=506, y=1..2
x=498, y=10..13
x=504, y=10..13
y=13, x=498..504
"""

extension Sequence {
    func count(where predicate: (Element) throws -> Bool) rethrows -> Int {
        var count = 0
        for element in self {
            if try predicate(element) {
                count += 1
            }
        }
        return count
    }
}

extension String {
    var integers: [Int] {
        return self
            .split{ "-0123456789".contains($0) == false }
            .map { Int($0)! }
    }
}

extension MutableCollection {
    mutating func modifyEach(_ transform: (inout Element) throws -> ()) rethrows {
        for index in indices {
            try transform(&self[index])
        }
    }
}

struct Position: Equatable {
    var x: Int
    var y: Int
}

struct Tile {
    enum Kind {
        case spring, sand, clay, moist, wet
    }
    
    let position: Position
    var kind: Kind
    
    var x: Int { return position.x }
    var y: Int { return position.y }
}

let springPosition = Position(x: 500, y: 0)

let clayRanges = input
    .components(separatedBy: .newlines)
    .flatMap { line -> [Position] in
        let numbers = line.integers
        
        switch line.first {
        case "x": return (numbers[1]...numbers[2]).map { Position(x: numbers[0], y: $0) }
        case "y": return (numbers[1]...numbers[2]).map { Position(x: $0, y: numbers[0]) }
        default: fatalError("Unexpected input")
        }
    }

let minMaxX = (min: clayRanges.min(by: { $0.x < $1.x })!.x, max: clayRanges.max(by: { $0.x < $1.x })!.x)
let minMaxY = (min: clayRanges.min(by: { $0.y < $1.y })!.y, max: clayRanges.max(by: { $0.y < $1.y })!.y)

let xRange = (minMaxX.min - 1) ... (minMaxX.max + 1)
let yRange = 0 ... (minMaxY.max + 1)

let scorableRange = minMaxY.min ... minMaxY.max

let shiftedSpringPosition = Position(x: springPosition.x - xRange.lowerBound, y: springPosition.y)

func printBoard(_ board: [[Tile]]) {
    for row in board {
        var text = ""
        for item in row {
            let value: String = {
                switch item.kind {
                case .clay: return "#"
                case .wet: return "~"
                case .moist: return "|"
                case .sand: return "."
                case .spring: return "+"
                }
            }()
            text.append(value)
        }
        print(text)
    }
}

let board = yRange.map { y in
    xRange.map { x -> Tile in
        let position = Position(x: x, y: y)
        
        let kind: Tile.Kind
        if position == springPosition {
            kind = .spring
        } else if clayRanges.contains(position) {
            kind = .clay
        } else {
            kind = .sand
        }
        
        let actualPosition = Position(x: x - xRange.lowerBound, y: y - yRange.lowerBound)
        return Tile(position: actualPosition, kind: kind)
    }
}

func dropWater(_ board: [[Tile]], from startingPosition: Position) -> [[Tile]] {
    var board = board
    
    let x: Int = startingPosition.x
    var y: Int = startingPosition.y
    
    while y + 1 < board.count && (board[y + 1][x].kind != .clay && board[y + 1][x].kind != .wet) {
        y += 1
        board[y][x].kind = .moist
    }
    
    if y >= scorableRange.upperBound {
        return board
    }
    
    var xLimitLeft = x
    var xLimitRight = x
    
    var didFillRow = false
    
    repeat {
        didFillRow = false
    
        xLimitLeft = x
        while xLimitLeft - 1 >= 0 && board[y][xLimitLeft - 1].kind != .clay && (board[y + 1][xLimitLeft - 1].kind == .clay || board[y + 1][xLimitLeft - 1].kind == .wet) {
            xLimitLeft -= 1
        }
        
        xLimitRight = x
        while xLimitRight + 1 < board[y].count && board[y][xLimitRight + 1].kind != .clay && (board[y + 1][xLimitRight + 1].kind == .clay || board[y + 1][xLimitRight + 1].kind == .wet) {
            xLimitRight += 1
        }
        
        let edges = [board[y][xLimitLeft - 1], board[y][xLimitRight + 1]]
        if edges.allSatisfy({ $0.kind == .clay || $0.kind == .wet }) {
            board[y][xLimitLeft...xLimitRight].modifyEach { $0.kind = .wet }
            y -= 1
            didFillRow = true
        }
    } while didFillRow

    board[y][xLimitLeft...xLimitRight].modifyEach { $0.kind = .moist }
    
    if board[y + 1][xLimitLeft - 1].kind == .sand {
        board[y][xLimitLeft - 1].kind = .moist
        board = dropWater(board, from: Position(x: xLimitLeft - 1, y: y))
    }
    
    if board[y + 1][xLimitRight + 1].kind == .sand {
        board[y][xLimitRight + 1].kind = .moist
        board = dropWater(board, from: Position(x: xLimitRight + 1, y: y))
    }
    
    return board
}

let newBoard = dropWater(board, from: shiftedSpringPosition)

func partOne() -> String {
    let allowedKinds: Set<Tile.Kind> = [.moist, .wet]
    let count = newBoard
        .map { $0.count { scorableRange.contains($0.position.y) && allowedKinds.contains($0.kind) } }
        .reduce(0, +)
    
    let result = "\(count)"
    return result
}

func partTwo() -> String {
    let count = newBoard
        .map { $0.count { scorableRange.contains($0.position.y) && $0.kind == .wet } }
        .reduce(0, +)
    
    let result = "\(count)"
    return result
}

print(partOne())
print(partTwo())
//: [Next](@next)
